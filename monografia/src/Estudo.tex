\chapter{Estudo realizado}
Para realização dos experimentos, foi desenvolvida uma aplicação web contendo diversas vulnerabilidades do tipo \estrangeiro{XPath Injection}. Também foram utilizadas aplicações listadas no \emph{Vulnerable Sites Database}, além de vulnerabilidades encontradas em estudos de outras pessoas. No total, foram avaliadas trinta e duas vulnerabilidades, sendo dez em \estrangeiro{web services} e as demais aplicações tradicionais, executadas em um navegador.

\section{Scanners utilizados}
Nesse estudo foram utilizados três scanners de vulnerabilidade: Arachni, w3af e webCruiser. As seções a seguir descrevem brevemente esses scanners.

\subsection{Arachni}
\estrangeiro{Arachni is a feature-full, modular, high-performance Ruby framework aimed towards helping penetration testers and administrators evaluate the security of web applications. Unlike other scanners, Arachni takes into account the dynamic nature of web applications and can detect changes caused while travelling through the paths of a web application's cyclomatic complexity}\cite{site:arachni}.

Arachni é um framework para auditoria de aplicações web capaz de detectar grande parte das vulnerabilidades conhecidas. Ele suporta extensões, ou seja, módulos para detecção de novas vulnerabilidades podem ser desenvolvidos e acoplados ao scanner principal.

Três interfaces principais estão disponíveis: linha de comando, interface web e XMLRPC, permitindo que outras aplicações interajam com o scanner.

Além disso, é um projeto de código aberto e bem documentado, o que facilita seu uso e integração.

\subsection{w3af}
\estrangeiro{w3af is a Web Application Attack and Audit Framework. The project's goal is to create a framework to find and exploit web application vulnerabilities that is easy to use and extend\cite{site:w3af}.}

O w3af é um scanner de vulnerabilidade e ferramenta de exploração de serviços web. Ele é dividido em duas partes: o núcleo, responsável por coordenar o processo de exploração da aplicação, e os \estrangeiro{plugins}, que procuram as vulnerabilidades. Mais de 100 plugins estão disponíveis\cite{site:w3af:plugins}, capazes de encontrar a maioria dos tipos de vulnerabilidades conhecidos. Dentre os scanners avaliados, foi o único capaz de analisar \estrangeiro{web services}.

É um projeto de código aberto e desde 2010 está sendo desenvolvido em parceria com a Rapid7\cite{w3af:rapid7}, um dos maiores desenvolvedores de soluções para detecção de vulnerabilidades em aplicações web. Com a parceria, a Rapid7 disponibiliza um time para trabalhar no w3af em troca de utilizar parte da tecnologia em seus próprios softwares.

\subsection{WebCruiser - Web Vulnerability Scanner}
\estrangeiro{WebCruiser - Web Vulnerability Scanner, an effective and powerful web penetration testing tool that will aid you in auditing your website! It has a Vulnerability Scanner and a series of security tools. It can support scanning website as well as POC (Proof of concept) for web vulnerabilities: SQL Injection, Cross Site Scripting, XPath Injection etc. So, WebCruiser is also an automatic SQL injection tool, an XPath injection tool, and a Cross Site Scripting tool\cite{site:webcruiser}!}

O \emph{WebCruiser} é o único scanner comercial dentre os avaliados.


\section{Funcionamento dos scanners}
A detecção de \estrangeiro{XPath Injection} no Arachni e no w3af funcionam de forma parecida: ele tentam forçar uma expressão \estrangeiro{XPath} inválida e procuram por mensagens de erro que essas expressões possam disparar.

O w3af tenta enviar a string \texttt{d'z``0}, enquanto o Arachni utiliza \texttt{'``}. Nos dois casos, normalmente uma expressão inválida será gerada. A figura \ref{fig:XPathScanners} mostra uma expressão XPath formada com o ataque do w3af (linha 1) e do Arachni (linha 2) em uma aplicação desenvolvida para realizar os testes.

\figura{XPathScanners}{Exemplo de expressão XPath gerada com ataque dos scanners Arachni e w3af}{12cm}

No ataque com o Arachni, a expressão fica inválida pois uma string é iniciada com o \texttt{``}, mas ela nunca é encerrada (não existe um \texttt{''}.

O w3af também deixa uma string em aberto, começando no \texttt{``}, além de deixar um caractere ``solto'' (\texttt{z}) na expressão.

O WebCruiser utilizou um \estrangeiro{approach} diferente para detecção, injetando um conteúdo válido para a expressão e analisando as requisições HTTP para verificar se a vulnerabilidade existe. O conteúdo injetado foi \texttt{99999999' or '7'='7}, deixando a expressão XPath válida e garantindo que pelo menos um nó sempre seja retornado. A figura \ref{fig:XPathWC} mostra como ficou a expressão XPath com o ataque realizado pelo WebCruiser.

\figura{XPathWC}{Exemplo de expressão XPath gerada com ataque do WebCruiser}{12cm}

\section{Resultados}
Todos os scanners detectaram diversos tipos de vulnerabilidades em todas as aplicações avaliadas, mas poucas das vulnerabilidades \estrangeiro{XPath injection} foram encontradas, como pode ser observado na tabela \ref{tab:vulnerabilidades}.

\begin{table}[h]
 \centering
 \begin{tabular}{lr}
 \toprule
  \textbf{\estrangeiro{Scanner}} & \textbf{Quantidade} \\
  \midrule
  Arachni & 3 \\
  \midrule
  w3af & 3 \\
  \midrule
  WebCruiser & 5 \\
  \bottomrule
 \end{tabular}
 
 \caption{Vulnerabilidades encontradas}
 \label{tab:vulnerabilidades}
\end{table}

O Arachni e o w3af não só detectaram a mesma quantia de vulnerabilidades, mas detectaram as mesmas três vulnerabilidades. Isso já era esperado, já que esses dois scanners possuem implementações parecidas para detecção desse tipo de vulnerabilidade.

O WebCruiser detectou uma quantidade de vulnerabilidades maior, das quais apenas uma foi detectada também pelos outros scanners.